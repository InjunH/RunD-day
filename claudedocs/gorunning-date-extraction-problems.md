# gorunning.kr 날짜 추출 방식의 근본적 문제점 분석

> **작성일**: 2026-01-21
> **심각도**: 🔴 HIGH
> **상태**: 🚨 Critical Design Flaw
> **영향 범위**: 서울 대회 40개 전체 + 기타 다수 대회

---

## 1. 핵심 문제

### 1.1. 현재 구현 방식

```typescript
// scripts/scrapers/sources/gorunning.ts:241-262
private extractDateFromName(name: string): string {
  // 대회명에서 "1월31일", "01.31" 같은 패턴 찾기
  const koreanMatch = name.match(/(\d{1,2})월\s*(\d{1,2})일?/);
  const dotMatch = name.match(/(\d{1,2})[./](\d{1,2})/);

  // 매칭 실패 시 → 2026-12-31 반환
  return this.getDefaultDate();  // "2026-12-31"
}
```

**문제**: 대회명은 날짜 정보의 신뢰할 수 있는 소스가 아닙니다.

### 1.2. 실제 결과

| 대회명 | 추출 결과 | 실제 날짜 | 정확도 |
|--------|----------|----------|--------|
| "제2회 한강 서울 하프 마라톤" | `2026-12-31` | **알 수 없음** | ❌ |
| "2026 머니투데이방송 삼일절 마라톤" | `2026-12-31` | 3월 1일? | ❌ |
| "2026 청춘릴레이 마라톤" | `2026-12-31` | **알 수 없음** | ❌ |
| "춘천마라톤 5월3일" | `2026-05-03` | 5월 3일 | ✅ (운 좋음) |

**현재 상태**: 서울 대회 40개가 **모두 2026-12-31**로 잘못 등록됨

---

## 2. 왜 이런 방식을 쓰게 되었나?

### 2.1. gorunning.kr 테이블 구조

```
┌────┬─────────┬──────┬──────┬──────┬──────┬────────────┐
│순번│ 대회명  │ 종목 │ 지역 │ 장소 │ 주최 │ 등록상태   │
├────┼─────────┼──────┼──────┼──────┼──────┼────────────┤
│  1 │ 한강... │ 하프 │ 서울 │ ... │ ... │ 접수중     │
└────┴─────────┴──────┴──────┴──────┴──────┴────────────┘
        ↑ 날짜 열 없음!
```

**근본 원인**: 웹사이트 자체에 날짜 정보가 테이블에 없습니다.

### 2.2. 선택지와 결정

1. ❌ **선택된 방식**: 대회명에서 추측 (불안정)
2. ⏱️ **미선택**: 상세 페이지 크롤링 (느림, 142개 × 1초 = 2.4분)
3. 🚫 **미선택**: gorunning 데이터 포기 (데이터 손실)

**결정 배경**: 속도를 위해 정확도를 희생 (잘못된 트레이드오프)

---

## 3. 설계상 결함

### 3.1. 데이터 품질 문제

```
정확도 = (올바른 날짜 / 전체 이벤트)
       = (102개 / 142개)
       = 71.8%

오류율 = 28.2% 🚨
```

**28.2%의 이벤트가 잘못된 날짜를 가집니다.**

### 3.2. 사용자 경험 파괴

- 사용자가 "1월" 필터 선택 → 서울 대회 안 보임 (실제론 1월 대회 있을 수 있음)
- 사용자가 "12월" 필터 선택 → 서울 대회 40개 전부 보임 (실제론 12월 아닐 수 있음)
- **신뢰할 수 없는 필터링 결과**

### 3.3. 유지보수 악몽

```typescript
// 이런 식으로 계속 패턴 추가?
if (name.includes('삼일절')) return '2026-03-01';
if (name.includes('광복절')) return '2026-08-15';
if (name.includes('한글날')) return '2026-10-09';
if (name.includes('어린이날')) return '2026-05-05';
// 끝없는 edge case 추가...
```

**유지보수 불가능**

---

## 4. 올바른 해결 방안

### 4.1. 🎯 상세 페이지 크롤링 (권장)

**장점**:
- 정확한 날짜 정보 확보 (100% 정확도 목표)
- 추가 정보 수집 가능 (가격, 이미지, 상세설명)
- 유지보수 간단 (DOM 구조만 파악)

**단점**:
- 스크래핑 시간 증가 (~2-3분)
- 네트워크 요청 142회 추가

**구현 예시**:
```typescript
async scrape(): Promise<ScraperResult> {
  // 1. 목록 페이지에서 대회 링크 수집
  const raceLinks = await this.extractRaceLinks(page);

  // 2. 각 상세 페이지에서 정보 추출 (병렬 처리)
  const events = await Promise.all(
    raceLinks.map(link => this.scrapeDetailPage(link))
  );
}

private async scrapeDetailPage(url: string): Promise<RawMarathonEvent> {
  const page = await browser.newPage();
  await page.goto(url);

  // 상세 페이지의 명확한 날짜 필드 추출
  const date = await page.locator('.race-date').textContent();
  // ...
}
```

### 4.2. ⚡ API 사용 (이상적)

gorunning.kr에 API가 있다면:
```typescript
const response = await fetch('https://gorunning.kr/api/races');
const data = await response.json();
// → 정확한 구조화된 데이터
```

**확인 필요**: gorunning.kr API 존재 여부

### 4.3. 🗑️ gorunning 데이터 제외 (최후 수단)

- AIMS 데이터(371개)만 사용
- 품질 > 양
- 142개 손실 but 100% 정확도

---

## 5. 비교 분석

| 방식 | 정확도 | 속도 | 유지보수 | 추천도 |
|------|--------|------|----------|--------|
| **현재 (대회명 추측)** | 71.8% | 빠름 | 매우 나쁨 | ❌ |
| **상세 페이지 크롤링** | ~95%+ | 느림 | 보통 | ✅ |
| **API 사용** | 100% | 빠름 | 좋음 | ⭐ (있다면) |
| **gorunning 제외** | 100% | 빠름 | 좋음 | 🤔 |

---

## 6. 영향 범위

### 6.1. 현재 영향받는 데이터

```bash
# 서울 대회 전체
jq -r '.[] | select(.region == "서울" and .date == "2026-12-31")' marathons.json | jq -s 'length'
# 결과: 40개
```

### 6.2. 잠재적 영향

- 다른 지역 대회도 날짜 없으면 12월 31일로 잘못 저장
- 사용자 신뢰도 하락
- 필터 기능 무용지물화

---

## 7. 권장 액션 플랜

### Phase 1: 긴급 완화 (1일)
```
1. gorunning 데이터를 임시로 필터링 제외
2. AIMS 데이터(371개)만 사용하여 서비스 품질 보장
3. 사용자에게 "일부 대회 정보 업데이트 중" 안내
```

### Phase 2: 근본 해결 (3-5일)
```
1. gorunning.kr 상세 페이지 DOM 구조 분석
2. 상세 페이지 크롤링 로직 구현
3. 병렬 처리로 성능 최적화 (Promise.all, 동시 5개씩)
4. 에러 핸들링 및 재시도 로직
5. 통합 테스트 및 검증
```

### Phase 3: 품질 보장 (1일)
```
1. 날짜 검증 로직 추가 (과거/미래 1년 이내만 허용)
2. 경고 로그: 기본값 사용 시 알림
3. 메트릭: 정확도 추적
```

---

## 8. 결론

**현재 방식은 근본적으로 잘못되었습니다.**

- ❌ 대회명은 날짜의 신뢰할 수 있는 소스가 아님
- ❌ 28.2% 오류율은 허용 불가
- ❌ 패턴 매칭은 유지보수 불가능

**해결책**: 상세 페이지 크롤링으로 정확한 날짜 추출

**우선순위**: 🔴 HIGH - 사용자 경험에 직접 영향

---

**작성자**: Claude
**참고 문서**: [docs/03-issues/01_gorunning-date-parsing.issue.md](../docs/03-issues/01_gorunning-date-parsing.issue.md)
